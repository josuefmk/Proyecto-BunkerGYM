{% extends 'core/home.html' %}
{% load static %}

{% block content %}

    <form method="post" class="busqueda-container">
        {% csrf_token %}
        <input type="text" name="rut" placeholder="Buscar Cliente por RUT" value="{{ rut_buscado }}" required>
        <button type="submit">üîç</button>
    </form>

    {% if clientes %}
        <table class="tabla-renovar">
    <thead>
        <tr>
            <th>Nombre Completo</th>
            <th>RUT</th>
            <th>Correo</th>
            <th>Telefono</th>
            <th>Tipo de Plan</th>
            <th>Plan Personalizado</th>
            <th>Estado De Plan</th>
            <th>Renovar</th>
        </tr>
    </thead>
    <tbody>
        {% for cliente in clientes %}
        <tr>
            <td>{{ cliente.nombre }} {{ cliente.apellido }}</td>
            <td>{{ cliente.rut }}</td>
            <td>{{ cliente.correo }}</td>
            <td>+ {{ cliente.telefono }}</td>

        <!-- Tipo de plan -->
        <td>
            <form method="post" action="{% url 'cambiar_tipo_plan_mensual' %}">
                {% csrf_token %}
                <input type="hidden" name="rut_cliente" value="{{ cliente.rut }}">
                <select name="nuevo_plan" onchange="this.form.submit()" class="select-bonito">
                    <option value="">-- Selecciona --</option>
                    {% for opcion in tipos_mensualidad %}
                        <option value="{{ opcion }}" {% if cliente.mensualidad and cliente.mensualidad.tipo == opcion %}selected{% endif %}>
                            {{ opcion }}
                        </option>
                    {% endfor %}
                </select>
            </form>
        </td>

        <!-- Plan personalizado -->
        <td>
            <form method="post" action="{% url 'cambiar_plan_personalizado' %}">
                {% csrf_token %}
                <input type="hidden" name="rut_cliente" value="{{ cliente.rut }}">
                <select name="nuevo_plan" onchange="this.form.submit()" class="select-bonito">
                    <option value="">-- Selecciona --</option>
                    {% for plan in planes_personalizados %}
                        <option value="{{ plan.id }}" {% if cliente.plan_personalizado and cliente.plan_personalizado.id == plan.id %}selected{% endif %}>
                            {{ plan.nombre_plan }}
                        </option>
                    {% endfor %}
                </select>
            </form>
        </td>


        <!-- Estado del plan -->
        <td>
            {% if cliente.dias_restantes == 0 %}
                Vencido
            {% else %}
                Activo ({{ cliente.dias_restantes }} d√≠as restantes)
            {% endif %}
        </td>
        <td>
           <button type="button" class="btn-global" onclick="confirmarRenovacion('{{ cliente.rut }}')">Renovar</button>
        </td>
    </tr>
    {% endfor %}
</tbody>
    </table>
{% else %}
   <p style="text-align: center; font-size: 18px; color: black;">
    No se encontr√≥ el RUT del Cliente.
</p>
{% endif %}


    <div id="modal-confirmar" class="modal-renovar" style="display: none;">
        <div class="modal-content-renovar">
            <p>¬øEst√°s seguro que deseas renovar el plan?</p>
            <form method="post" action="{% url 'renovarCliente' %}">
            {# <form method="post" action="{% url 'renovarCliente' %}?rut={{ rut_buscado }}">#}
                {% csrf_token %}
                <input type="hidden" id="rut-renovar" name="renovar_rut">
                <button type="submit">S√≠, renovar</button>
                <button type="button" onclick="cerrarModal()">Cancelar</button>
            </form>
        </div>
    </div>



<script>
function confirmarRenovacion(rut) {
    document.getElementById('rut-renovar').value = rut;
    document.getElementById('modal-confirmar').style.display = 'flex';
}
function cerrarModal() {
    document.getElementById('modal-confirmar').style.display = 'none';
}
</script>

{% endblock %}
