{% extends 'core/home.html' %}
{% load static %}

{% block content %}
<main class="contenido">

    {% if mensaje %}
    <div id="mensaje-exito-registro" style="
        background-color: #d4edda;
        color: #155724;
        border: 1px solid #c3e6cb;
        padding: 10px;
        margin-bottom: 15px;
        border-radius: 5px;
    ">
        {{ mensaje }}
    </div>
    <script>
    setTimeout(function() {
        var mensajeDiv = document.getElementById('mensaje-exito-registro');
        if (mensajeDiv) {
            mensajeDiv.style.display = 'none';
        }
    }, 5000);
    </script>
    {% endif %}

    <div class="form-container">
        <form class="formulario" method="POST" novalidate>
            {% csrf_token %}
            <h2>CreaciÃ³n De Cliente</h2>

            {% for field in form %}
                <label for="{{ field.id_for_label }}">{{ field.label }}:</label>
                {{ field }}
                {% for error in field.errors %}
                    <p class="error">{{ error }}</p>
                {% endfor %}
            {% endfor %}

            <button type="submit" class="btn-global" style="margin-top: 15px;">âœ… Crear Cliente</button>
            <a href="{% url 'index' %}" class="btn-global" style="margin-top: 15px;">ðŸ”™ Volver</a>
        </form>
    </div>
 <!-- 
    {% if cliente %}
   Modal para registro de huella 
    <div id="modalHuella" class="modal" style="display:none;">
        <div class="modal-content">
            <button id="btnCerrarModalHuella" style="float:right;">âœ–</button>
            <h2>Registro de Huella</h2>
            <p id="estadoHuella">Presiona el botÃ³n para comenzar</p>
            <button id="btnCapturarHuella" class="btn-global">Capturar Huella</button>
        </div>
    </div>
    {% endif %}
-->
</main>
 <!-- 
{% if cliente %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Mostrar modal automÃ¡ticamente al crear cliente
        const modalHuella = document.getElementById('modalHuella');
        if(modalHuella){
            modalHuella.style.display = 'flex';
        }
    });
</script>
{% endif %}

<script>
  
    const modalHuella = document.getElementById('modalHuella');
    const btnCerrarModal = document.getElementById('btnCerrarModalHuella');
    const btnCapturarHuella = document.getElementById('btnCapturarHuella');
    const estadoHuella = document.getElementById('estadoHuella');

    if(btnCerrarModal) {
        btnCerrarModal.onclick = () => modalHuella.style.display = 'none';
    }

    if(btnCapturarHuella) {
        btnCapturarHuella.onclick = () => {
            estadoHuella.textContent = "Capturando huella...";

            // SimulaciÃ³n de captura de huella base64
            setTimeout(() => {
                const templateFakeBase64 = btoa("template_de_huella_simulado");

                const clienteId = {{ cliente.id }};

                fetch(`/api/guardar_huella/${clienteId}/`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-CSRFToken': '{{ csrf_token }}'
                    },
                    body: JSON.stringify({template: templateFakeBase64})
                })
                .then(resp => resp.json())
                .then(data => {
                    if(data.mensaje) {
                        estadoHuella.textContent = "âœ… Huella registrada correctamente.";
                    } else {
                        estadoHuella.textContent = "Error: " + (data.error || "Desconocido");
                    }
                })
                .catch(() => {
                    estadoHuella.textContent = "Error al guardar huella.";
                });
            }, 3000);
        };
    }

    // Cerrar modal si clic afuera
    window.onclick = (event) => {
        if(event.target === modalHuella) {
            modalHuella.style.display = 'none';
        }
    }
</script>

<script>
    document.addEventListener("DOMContentLoaded", function() {
        const rutInput = document.getElementById("id_rut");
        if (rutInput) {
            rutInput.addEventListener("input", function() {
                this.value = this.value.replace(/\./g, '');
            });
        }
    });
</script>
-->
{% endblock %}
