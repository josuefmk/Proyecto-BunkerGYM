{% extends 'core/home.html' %}
{% load static %}

{% block content %}
<main class="contenido">

    {% if mensaje %}
    <div id="mensaje-exito-registro" style="
        background-color: #d4edda;
        color: #155724;
        border: 1px solid #c3e6cb;
        padding: 10px;
        margin-bottom: 15px;
        border-radius: 5px;
    ">
        {{ mensaje }}
    </div>
    <script>
    setTimeout(function() {
        var mensajeDiv = document.getElementById('mensaje-exito-registro');
        if (mensajeDiv) {
            mensajeDiv.style.display = 'none';
        }
    }, 5000);
    </script>
    {% endif %}

    <div class="form-container">
        <form class="formulario" method="POST" novalidate>
            {% csrf_token %}
            <h2>CreaciÃ³n De Cliente</h2>

            {% for field in form %}
                {% if field.name != 'sub_plan' %} 
                    <label for="{{ field.id_for_label }}">{{ field.label }}:</label>
                    {{ field }}
                    {% for error in field.errors %}
                        <p class="error">{{ error }}</p>
                    {% endfor %}
                {% else %}
                    {{ field }} 
                {% endif %}
            {% endfor %}

            <button type="submit" class="btn-global" style="margin-top: 15px;">âœ… Crear Cliente</button>
            <a href="{% url 'index' %}" class="btn-global" style="margin-top: 15px;">ðŸ”™ Volver</a>
        </form>
    </div>

    <!-- Modal para seleccionar Sub Plan -->
    <div id="modalSubPlan" class="modal-custom" style="display:none;">
        <div class="modal-content-custom">
          
            <label><input type="radio" name="subPlanOption" value="Bronce"> ðŸ¥‰ Bronce (4 Accesos)</label><br>
            <label><input type="radio" name="subPlanOption" value="Hierro"> ðŸª™ Hierro (8 Accesos)</label><br>
            <label><input type="radio" name="subPlanOption" value="Acero"> ðŸ›¡ Acero (12 Accesos)</label><br>
            <label><input type="radio" name="subPlanOption" value="Titanio"> âš” Titanio (Acceso Libre)</label><br>
            <div style="margin-top: 15px;">
                <button type="button" onclick="guardarSubPlan()" class="btn-global modal-content-customv2">Aceptar</button>
            </div>
        </div>
    </div>

</main>

<script>
document.addEventListener("DOMContentLoaded", function() {
    const selectPlan = document.getElementById("id_mensualidad");
    if (selectPlan) {
        selectPlan.addEventListener("change", function() {
            if (this.value) {
                document.getElementById("modalSubPlan").style.display = "flex";
            }
        });
    }
});

function guardarSubPlan() {
    let elegido = document.querySelector('input[name="subPlanOption"]:checked');
    if (!elegido) {
        alert("Selecciona un sub plan");
        return;
    }
    document.getElementById("id_sub_plan").value = elegido.value;
    document.getElementById("modalSubPlan").style.display = "none";
}

window.onclick = (event) => {
    const modal = document.getElementById("modalSubPlan");
    if(event.target === modal) {
        modal.style.display = "none";
    }
};
</script>
{% endblock %}
