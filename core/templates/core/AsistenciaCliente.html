{% extends 'core/home.html' %}
{% block content %}
<main class="contenido asistencia">
    <div class="form-container-historial"> 
        <form method="POST" class="formulario">
            {% csrf_token %}
            <h2>Registro de Asistencia</h2>
            <label for="rut">Ingrese RUT</label>
            <input type="text" name="rut" id="rut" required>
<<<<<<< HEAD
        </form>
    </div>

=======
 
        </form>
    </div>

    {# üîπ Modal de confirmaci√≥n de asistencia final #}
>>>>>>> 4f161d7 (v18)
    {% if mostrar_modal %}
    <div class="modal-custom">
        <div class="modal-content-custom">
            <button onclick="cerrarModal()"></button>
            <h2>‚úÖ Registro de Asistencia</h2>
            <p>Bienvenido <strong>{{ cliente.nombre }} {{ cliente.apellido }}</strong></p>
            <p>El plan le vence el <strong>{{ vencimiento_plan|date:"d" }} de {{ vencimiento_plan|date:"F" }}</strong></p>
<<<<<<< HEAD
            <p>Le quedan <strong>{{ dias_restantes }}</strong> d√≠as de mensualidad</p>
         {% if cliente.sub_plan %}
            {% if cliente.sub_plan != "Titanio" %}
                <p>Accesos restantes: <strong>{{ cliente.accesos_restantes }}</strong></p>
            {% endif %}
        {% endif %}

        {% if cliente.plan_personalizado and cliente.plan_personalizado.nombre_plan != "Ninguno" %}
            {% if cliente.plan_personalizado.nombre_plan == "Semi Personalizado Full" %}
                <p>Acceso ilimitado esta semana</p>
            {% else %}
                <p>Accesos personalizados restantes esta semana: 
                    <strong>{{ cliente.accesos_semana_restantes|default:"0" }}</strong>
                </p>
            {% endif %}
        {% endif %}
    </div>
    {% endif %}

=======

            {# Mostrar d√≠as restantes solo si no es Plan Libre #}
        {# Subplan normal #}
{% if cliente.sub_plan and cliente.sub_plan != "Titanio" %}
    <p>Accesos restantes: <strong>{{ cliente.accesos_restantes }}</strong></p>
{% endif %}

{# Plan personalizado #}
{% if cliente.plan_personalizado %}
    {% if plan_full %}
        <p>Acceso ilimitado esta semana</p>
    {% elif not plan_libre %}
        <p>Accesos personalizados restantes esta semana: 
            <strong>{{ cliente.accesos_semana_restantes|default:"0" }}</strong>
        </p>
    {% endif %}
{% endif %}
        </div>
    </div>
    {% endif %}

    {# üîπ Modal de selecci√≥n de plan personalizado #}
    {% if planes_personalizados and planes_personalizados|length > 1 and not mostrar_modal %}
    <div class="modal-custom">
        <div class="modal-content-custom">
            <h2>Selecciona el plan personalizado</h2>
        <form method="POST">
    {% csrf_token %}
    <input type="hidden" name="rut" value="{{ cliente.rut }}">
    <input type="hidden" name="confirmar" value="1">
    <label for="plan_personalizado">Plan a usar:</label>
    <select name="plan_personalizado" id="plan_personalizado" required>
        {% for plan in planes_personalizados %}
            <option value="{{ plan.id }}">{{ plan.nombre_plan }}</option>
        {% endfor %}
    </select>
    <button type="submit" class="btn-confirmar">Confirmar Plan</button>
</form>
        </div>
    </div>
    {% endif %}

    {# üîπ Modales de error o alerta #}
>>>>>>> 4f161d7 (v18)
    {% if rut_invalido %}
    <div class="modal-custom modal-error-custom">
        <div class="modal-content-custom">
            <button onclick="cerrarModal()"></button>
            <h2 style="color:#dc3545;">‚ùå Error</h2>
            <p>El RUT ingresado no fue encontrado</p>
        </div>
    </div>
    {% endif %}

    {% if asistencia_ya_registrada %}
    <div class="modal-custom modal-warning-custom">
        <div class="modal-content-custom">
            <button onclick="cerrarModal()"></button>
            <h2 style="color:#ffc107;">‚ö†Ô∏è Atenci√≥n</h2>
            <p>El RUT ya est√° ingresado hoy.</p>
        </div>
    </div>
    {% endif %}

    {% if plan_vencido %}
    <div class="modal-custom modal-error-custom">
        <div class="modal-content-custom">
            <button onclick="cerrarModal()"></button>
            <h2 style="color:#dc3545;">‚ùå Plan Vencido</h2>
            <p>Debe renovarlo para poder ingresar.</p>
        </div>
    </div>
    {% endif %}

    {% if sin_accesos %}
    <div class="modal-custom modal-error-custom">
        <div class="modal-content-custom">
            <button onclick="cerrarModal()"></button>
            <h2 style="color:#dc3545;">‚ùå Sin Accesos</h2>
            <p>No le quedan accesos disponibles para ingresar.</p>
        </div>
    </div>
    {% endif %}

<<<<<<< HEAD
    {% if sin_plan_asignado %}
    <div class="modal-custom modal-error-custom">
        <div class="modal-content-custom">
            <button onclick="cerrarModal()"></button>
            <h2 style="color:#dc3545;">‚ùå Sin Plan Asignado</h2>
            <p>Este cliente no tiene un subplan o plan personalizado asignado.</p>
        </div>
    </div>
    {% endif %}

=======
>>>>>>> 4f161d7 (v18)
</main>

<script>
function cerrarModal() {
    document.querySelectorAll('.modal-custom').forEach(modal => modal.style.display = 'none');
}

document.addEventListener("DOMContentLoaded", function() {
    document.querySelectorAll('.modal-custom').forEach(modal => {
        setTimeout(() => { cerrarModal(); }, 5000);
    });
});
</script>
{% endblock %}
